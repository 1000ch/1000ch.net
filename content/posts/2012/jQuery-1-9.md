---
layout: post
title: jQuery1.9の変更内容をまとめてみる
date: 2012-12-19
---

# jQuery1.9の変更内容をまとめてみる

先日jQuery1.9beta1が公開されましたが、ロードマップは変わらないだろうし。
主にAPIの洗い直しですね。前々から非推奨アナウンスがあったものを削除したり、内部APIの整理で、ファイルサイズの削減とパフォーマンスが向上される予定。
2.0は古いIE等のサポートを止め、再設計・軽量化なので1.9とAPIは変わらないと思い込みながら。
最近のjQueryはフルコメントで10000行くらいありましたが、2.0でどのくらいになるんでしょう。
超軽くなったりしないかな。恐らくないな。

- [jQuery Blog > jQuery 1.9 Beta 1 Released](http://blog.jquery.com/2012/12/17/jquery-1-9-beta-1-released/)
- [jQuery Core 1.9 Upgrade Guide](http://jquery.com/upgrade-guide/1.9/)

↑のUpgrade Guideを読み流してみます。

## `.add()`

内部処理の仕方を変更。  

## `.addBack(selector)`が`.addSelf()`に

一応エイリアスとして残るみたいです。  

## `.after()`と`.before()`と`.replaceWith()`

親を持たないノードの変更はバグを生む可能性があるので、  
内包する対象ノードが **親を持たない場合はこれらを使っても何もしない** ようです。  

## `.appendTo()`と`.insertBefore()`と`.insertAfter()`と`.replaceAll()`

要素の追加や削除系の関数ですが、1.9以降は`.end()`をしなくても、  
**要素が追加や削除された状態のjQueryオブジェクトを返す** ようです。  

## checkboxのクリック時イベントのハンドラ中の状態

未チェックのチェックボックスをクリックするとクリックイベントが発火されますが、
クリックイベント中でのチェックボックスの状態が、v1.8以前は未チェックだったことに対し
v1.9からはチェックされた状態でコールバックされるようになったようです。
**ユーザーアクションと反対の状態で取得出来る** ってことですね。我ながらわかり難い日本語。

## focusイベント

ネイティブのfocusイベントは、DOMがフォーカスされてから初めてイベントが発火されますがv1.9は、DOMがフォーカスされなくてもfocusイベントの実施を最後まで行います。
`focus()`あるいは`trigger("focus")`で、内包する要素に対しfocusを発火しますが、focusイベントがハンドルされない要素があっても、全ての要素に発火をするということになります。

## `$(htmlString)`と`$(selectorString)`

**引数にhtmlタグが含まれていたらhtmlStringとして扱う。**
タグ形式であってもhtmlタグではない場合は認識されず、`$.parseHTML()`を通すことで初めてDOMノードが生成される。

プラグインは用意されるようですが、有効なcss selectorでも今までのようには動かないようで、移行の際は注意ですね。なるべく`#id`と`.className`で走査しろということなんでしょうか。

## `.data()`メソッドからイベントは発火されない

set/getで監視しないようになったようです。
また、`.data("abc.def")`はabc.defの値のみ取得し、abcからは取得しないとのこと。
そうか、datasetに直アクセスならドット含んだりも出来るんだね…。わざわざしないけど。

## jQueryの独立したノードの順序

うーん、これはいいか。  

## html要素中にscriptがある場合実行するようになった

html文字列を扱うメソッド（`.append()`とか`.wrap()`とか）にscriptがある場合は  
**1.9以降はscriptを実行する**ようになり、再実行されるのを防ぐため  
そのscriptのノードは除かれるらしいです。ほほう。  
scriptは同期的に評価されるため実行に時間がかかり、また  
scriptの挙動に対してアクセスするインターフェースは用意しませんとのこと。  
**「scriptの実行のためにこの挙動を利用するな！」**  
新しいscriptをロードするときには`jQuery.getScript()`を使ってね。  

## `.attr()`と`.prop()`

`.prop()`はプロパティの値の取得と設定のために1.6から用意されて、`.attr()`は値の設定には使わないようにされてきました。
1.9においては特別なケースの`.attr()`の使用をサポートするそうです。[例えばチェックボックスの値の設定時の挙動。](http://jquery.com/upgrade-guide/1.9/#attr-versus-prop-)

## 古代IEにおける`$("input").attr("type", newValue)`

1.9においてもIE6/7/8だと例外が発生するものの、許容するブラウザのために残し、使える場合はどうぞ使ってくださいとのこと。
こんなイレギュラーなことしないけど。2.0向けのスタンスってことなのでしょうか。

## 擬似イベントhover

`mouseenter`+`mouseleave`と同義なのでサポートしないって。  

## jQueryオブジェクトの`.selector`プロパティ

元々非推奨のプロパティですが、v1.9からはメソッドチェーンの場合などにこのプロパティの整合性を保つことをしません。まぁ、これもあまり使わないですね。

## `jQuery.attr()`

明示されていなかった`jQuery.attr(elem, name, value, pass)`をサポートしなくなります。
よって、今後はpassを引数として使うことが出来なくなります。

## `jQuery.ajax()`のJSON結果が空文字の場合

`jQuery.ajax`が、JSONの結果が空文字の場合を考慮するようになったようです。v1.9以降、空文字の場合は不正な形式とし、例外をスローします。
ただし`null`の場合を除くようで、この場合、`success`あるいは`promise`をハンドルします。  

## `jQuery.proxy()`のcontext

コールバック中のthisがproxy()によって適切に割りあたるようになった。  
…ってことでしょうか。コールバックの呼び出し元がnullかundefinedの場合、  
thisはwindowになるようです。  

## `.jQuery.sub()`が削除される

Coreから外され、プラグインに移動。  

## `.data("events")`

jQueryの明示されていない内部的なイベントデータを取得します。
一般的に使わないため公開インターフェースを用意していないため、だそうです。あまり気にしなくても良いでしょう。

## 明示されていない引数をもつメソッド

- `jQuery.data()`
- `jQuery.removeData()`
- `jQuery.attr()`

少し前述しましたが、予想しない挙動を引き起こす引数の受け方をしなくなるそうです。  

## 削除されるプロパティとかメソッド

- `jQuery.deletedIds`
- `jQuery.uuid`
- `jQuery.attrFn`
- `jQuery.offset.bodyOffset()`

## まとめ

なんか拙い翻訳みたいになってしまいました。v2.0になったらもう一回jQueryと真剣に向き合います。
間違い等ありましたら[ご連絡](http://twitter.com/1000ch/)頂けると幸いです。
