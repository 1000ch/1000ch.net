<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Babelとの併用を止めてTypeScriptビルド一本化へ - EagleLand</title><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.png><link rel="shortcut icon" href=/favicon.svg type=image/svg+xml sizes=any><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/github.min.css><link rel=stylesheet href=/css/font.css><link rel=stylesheet href=/css/settings.css><link rel=stylesheet href=/css/tools.css><link rel=stylesheet href=/css/generic.css><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/objects.css><link rel=stylesheet href=/css/components.css><link rel=stylesheet href=/css/trumps.css><link rel=alternate href=/rss.xml title=1000ch.net type=application/rss+xml><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Mono"><meta name=author content="Shogo Sensui"><meta name=copyright content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan"><meta property="og:description" content="Babelとの併用を止めてTypeScriptビルド一本化へ 最近は社内で Web おじさん業をやる傍ら、プロジェクトコードなども少し触っている。最近では FRESH! でアレコレしていて、クライアントサイドとサーバーサイドの改善もやったり。
 FRESH! Web パフォーマンス改善 〜クライアントサイド編〜 | CyberAgent Developers Blog FRESH! Web パフォーマンス改善 〜サーバサイド編〜 | CyberAgent Developers Blog  ふたつ👆ともよくまとまっているので、未読の人は是非読んでください。
あとは開発環境周りもコツコツ直していたりする。Web クライアントの構成要素 - Client Side of █████fresh.tv で触れられている通り、TypeScript と Babel の多段ビルドで運用していた。型を使いたいモチベーションと JSX をコンパイルする事情が合わさってのことだが、最近では TypeScript が JSX に対応しているので、TypeScript ビルドへの統一に踏み切った。
JavaScriptをTypeScriptでビルドする TypeScript と JSX それぞれの JavaScript へのコンパイルに分かれていて、設定が2箇所に分かれている気持ち悪さと、ビルド結果を Browserify でバンドルする都合で双方の待ち合わせがあったりなどの、ビルド処理の複雑化を招いていた。TypeScript ビルドへ統一することでそれらが一気に解消された上に、ビルド時間への短縮にも繋がった。
ひとまず allowJs を駆使しながら TypeScript への一本化を果たして、ビルド時間が 90s から 70s 程になった。exports.__esModule = true; の優しさ。https://t.co/1nBGdZNcJ0
&mdash; 煎茶 🍵 (@1000ch) 2017年4月28日 対応内容としては単純で、babel でビルドしていた ."><meta property="og:image" content="https://1000ch.net/img/apple-touch-icon.png"><meta name=twitter:card content="summary"><meta property="og:type" content="article"><meta property="og:url" content="https://1000ch.net/posts/2017/typescript-without-babel.html"><meta property="og:site_name" content="EagleLand"><meta property="og:title" content="Babelとの併用を止めてTypeScriptビルド一本化へ"><meta name=twitter:site content="@1000ch"><meta name=twitter:url content="https://1000ch.net/posts/2017/typescript-without-babel.html"><meta name=twitter:title content="Babelとの併用を止めてTypeScriptビルド一本化へ"><meta name=google-site-verification content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49530352-1','1000ch.net');ga('send','pageview');</script></head><body><div class=Container><header class=Header><h1 class=Header__Title><a href=/>EagleLand</a></h1><nav class=Header__Menu><div class=Header__MenuItem><img src=/img/rss.svg alt>
<a href=/rss.xml>RSS</a></div><div class=Header__MenuItem><img src=/img/heart.svg alt>
<a href=https://shogosensui.com>Activity</a></div><div class=Header__MenuItem><img src=/img/facebook.svg alt>
<a href=https://www.facebook.com/1000ch.net>Facebook</a></div></nav></header><main class=Main><span class="Label Label--gray pull-left">2017.05.01</span><h1 id=babelとの併用を止めてtypescriptビルド一本化へ>Babelとの併用を止めてTypeScriptビルド一本化へ</h1><p>最近は社内で Web おじさん業をやる傍ら、プロジェクトコードなども少し触っている。最近では FRESH! でアレコレしていて、クライアントサイドとサーバーサイドの改善もやったり。</p><ul><li><a href=https://developers.cyberagent.co.jp/blog/archives/6057/>FRESH! Web パフォーマンス改善 〜クライアントサイド編〜 | CyberAgent Developers Blog</a></li><li><a href=https://developers.cyberagent.co.jp/blog/archives/5975/>FRESH! Web パフォーマンス改善 〜サーバサイド編〜 | CyberAgent Developers Blog</a></li></ul><p>ふたつ👆ともよくまとまっているので、未読の人は是非読んでください。</p><p>あとは開発環境周りもコツコツ直していたりする。<a href=http://s.aho.mu/160405-node_school/#8>Web クライアントの構成要素 - Client Side of █████fresh.tv</a> で触れられている通り、TypeScript と Babel の多段ビルドで運用していた。型を使いたいモチベーションと JSX をコンパイルする事情が合わさってのことだが、最近では <a href=https://www.typescriptlang.org/docs/handbook/jsx.html>TypeScript が JSX に対応している</a>ので、TypeScript ビルドへの統一に踏み切った。</p><h2 id=javascriptをtypescriptでビルドする>JavaScriptをTypeScriptでビルドする</h2><p>TypeScript と JSX それぞれの JavaScript へのコンパイルに分かれていて、設定が2箇所に分かれている気持ち悪さと、ビルド結果を Browserify でバンドルする都合で双方の待ち合わせがあったりなどの、ビルド処理の複雑化を招いていた。TypeScript ビルドへ統一することでそれらが一気に解消された上に、ビルド時間への短縮にも繋がった。</p><blockquote class=twitter-tweet data-lang=ja><p lang=ja dir=ltr>ひとまず allowJs を駆使しながら TypeScript への一本化を果たして、ビルド時間が 90s から 70s 程になった。exports.__esModule = true; の優しさ。<a href=https://t.co/1nBGdZNcJ0>https://t.co/1nBGdZNcJ0</a></p>&mdash; 煎茶 🍵 (@1000ch) <a href=https://twitter.com/1000ch/status/857766566775070722>2017年4月28日</a></blockquote><p>対応内容としては単純で、<code>babel</code> でビルドしていた <code>.js</code> ファイルを代わりに <code>tsc</code> でビルドするだけ。ここで JavaScript ファイルのコンパイルを有効にするため <code>tsconfig.json</code> に <code>"allowJs": true</code> を入れる。JSX が記述されている <code>.js</code> は順に <code>.tsx</code> に変更していかなければならないが、ほとんど何も変更せずに今まで動作しまっている。</p><p>JavaScript のスーパーセットというのと、JSX サポートが最高ということに尽きそう。</p><h2 id=eslinttypescript-eslint-parser>eslint/typescript-eslint-parser</h2><p>FRESH! では ESLint を採用しており、自家製の <a href=https://github.com/openfresh/eslint-config-fresh><code>openfresh/eslint-config-fresh</code></a> と <a href=https://github.com/openfresh/eslint-config-fresh-react><code>openfresh/eslint-config-fresh-react</code></a> をルールにしている（ほとんど <a href=https://github.com/sindresorhus/xo><code>xo</code></a> ベースだけど）。<code>tslint</code> も2分くらい検討したが
、公式の <a href=https://github.com/eslint/typescript-eslint-parser><code>eslint/typescript-eslint-parser</code></a> が動いてくれたのでこちらを使うことにした。</p><p><code>eslint-config-fresh</code> で <code>parser</code> に <code>babel-eslint</code> を指定していたところ、プロジェクトの <code>.eslintrc</code> で <code>typescript-eslint-parser</code> を指定しても先に <code>babel-eslint</code> が参照されてしまうようでうまく ESLint が動作しなかった（これが仕様なのかどうかはちゃんとに調べていない…）。これは <a href=https://github.com/openfresh/eslint-config-fresh/pull/5><code>eslint-config-fresh</code> 側で <code>parser</code> を指定しない方向で対処した</a>。</p><aside class=Share><div class=Share__Item><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2f1000ch.net%2fposts%2f2017%2ftypescript-without-babel.html" title="Share on Facebook" target=_blank><img src=/img/facebook.svg></a></div><div class=Share__Item><a href="https://twitter.com/share?url=https%3a%2f%2f1000ch.net%2fposts%2f2017%2ftypescript-without-babel.html&text=Babel%e3%81%a8%e3%81%ae%e4%bd%b5%e7%94%a8%e3%82%92%e6%ad%a2%e3%82%81%e3%81%a6TypeScript%e3%83%93%e3%83%ab%e3%83%89%e4%b8%80%e6%9c%ac%e5%8c%96%e3%81%b8" title="Share on Twitter" target=_blank><img src=/img/twitter.svg></a></div></aside><nav class=Pager><div class="Pager__Item Pager__Item--left"><a href=/posts/2017/frontrend-vol9.html>👈 Frontrend Vol.9 を開催しました</a></div><div class="Pager__Item Pager__Item--right"><a href=/posts/2017/update-pinfeed.html>PinFeedを色々手直しした 👉</a></div></nav></main><aside class=Aside><h1>Author</h1><div class=Media><picture>
<source srcset=/img/1000ch.webp type=image/webp><img class=Media__Figure src=/img/1000ch.jpg alt></picture><div class=Media__Body><h3 class=Media__Title>1000ch <a href=https://twitter.com/1000ch class=twitter-follow-button data-show-count=false data-show-screen-name=false>Follow @1000ch</a></h3><p>ソフトウェアエンジニア。SIer でのプログラマーを経て Web 業界に転職して以来、Web 技術に没頭する日々を送っている。Web 標準の動向やアーキテクチャの流行を追いかけつつ、技術啓蒙や OSS 活動に励んでいる。</p></div></div></aside><footer class=Footer><div class=Banner><div class=Banner__Item><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.ja target=_blank><img src=/img/by-nc-nd.png alt="CC BY-NC-ND 4.0" width=80 height=28></a></div><div class=Banner__Item><a href=https://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fhttps%3A%2F%2F1000ch.net%2Findex.xml target=_blank><img src=https://s3.feedly.com/img/follows/feedly-follow-rectangle-flat-medium_2x.png alt="follow me on feedly" width=71 height=28></a></div><div class=Banner__Item><form action=https://duckduckgo.com/ role=search><input name=sites type=hidden value=1000ch.net>
<input name=q type=search>
<input type=submit value=Search></form></div></div></footer></div><script defer src=https://platform.twitter.com/widgets.js></script><script defer src=https://platform.instagram.com/en_US/embeds.js></script><script defer src=https://assets.codepen.io/assets/embed/ei.js></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js></script><script type=module>
import AffiliateLink from '/js/affiliate-link.js';
import FluidIframe from 'https://cdn.jsdelivr.net/npm/fluid-iframe/dist/index.js';

customElements.define('affiliate-link', AffiliateLink);
customElements.define('fluid-iframe', FluidIframe);

document.querySelectorAll('pre code').forEach(block => {
  hljs.highlightBlock(block);
});

if (navigator.serviceWorker) {
  navigator.serviceWorker.register('/sw.js');
}
</script></body></html>