<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ES6のシンタックスを予習復習(1) ~let, const, Arrow Function, Generators, for of~ - EagleLand</title>

<link rel="icon" href="/favicon.png">
<link rel="shortcut icon" href="/favicon.png">
<link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml" sizes="any">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/github.min.css">
<link rel="stylesheet" href="/css/font.css">
<link rel="stylesheet" href="/css/settings.css">
<link rel="stylesheet" href="/css/tools.css">
<link rel="stylesheet" href="/css/generic.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/objects.css">
<link rel="stylesheet" href="/css/components.css">
<link rel="stylesheet" href="/css/trumps.css">
<link rel="alternate" href="/rss.xml" title="1000ch.net" type="application/rss+xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono">

<meta name="author" content="Shogo Sensui">
<meta name="copyright" content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan">


  
    <meta property="og:description" content="ES6のシンタックスを予習復習(1) ~let, const, Arrow Function, Generators, for of~ ES6のフォローについては書こうとしていたものの後手に回っていて、ようやく書くに至る。SetやらMapやら、追加クラスのあたりは実装されても試そうとした時にそんなに障壁にならない気がしてるけど、letとかconst、アローファンクション等々、シンタックスが関わる辺はつっかえ棒になりかねないので消化しておく。
この段階での実装状況はNightly &gt; Canary  Chrome Canary 34.0.1760.0 Firefox Nightly 29.0a1 (2013-12-25)  この2つをECMAScript 6 compatibility tableで比較するとNightlyのほうが先行実装は進んでいるのでNightlyでアレコレする。Canaryだと試したいシンタックス部分がまだ実装されていないので断念。
Canaryでデバッグしたい人はES6実装を有効にするフラグをたてる必要があるので、chrome://flagsにアクセスして#enable-javascript-harmonyでページを検索すると JavaScript の試験運用機能を有効にする という項目があるのでそれを有効にする。あとはDevTool開いてConsoleでいつも通り試せる。が、今回はFirefoxなのでScratchpadでやる。使い慣れてない…。
let letを使うことでブロックスコープの変数宣言が可能になる。
まず、今までのvarを使ったパターン。（これだとそもそもlintで怒られるけど、挙動のテストということで。）
var x = 1; if (true) { var x = 2; console.log(&#39;x is &#39; &#43; x); // x is 2 } console.log(&#39;x is &#39; &#43; x); // x is 2  このケースだと最初に宣言したxがif内で上書きされ、2回とも2が出力される。ここでletを使ってみる。
let x = 1; if (true) { let x = 2; console.">
  

  
    <meta property="og:image" content="https://1000ch.net/img/apple-touch-icon.png">
    <meta name="twitter:card" content="summary">
  


<meta property="og:type" content="article">
<meta property="og:url" content="https://1000ch.net/posts/2013/es6-features-1.html">
<meta property="og:site_name" content="EagleLand">
<meta property="og:title" content="ES6のシンタックスを予習復習(1) ~let, const, Arrow Function, Generators, for of~">

<meta name="twitter:site" content="@1000ch">
<meta name="twitter:url" content="https://1000ch.net/posts/2013/es6-features-1.html">
<meta name="twitter:title" content="ES6のシンタックスを予習復習(1) ~let, const, Arrow Function, Generators, for of~">

<meta name="google-site-verification" content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon.png">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-49530352-1', '1000ch.net');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div class="Container">
      <header class="Header">
  <h1 class="Header__Title">
    <a href="/">EagleLand</a>
  </h1>
  <nav class="Header__Menu">
    <div class="Header__MenuItem">
      <img src="/img/rss.svg" alt="">
      <a href="/rss.xml">RSS</a>
    </div>
    <div class="Header__MenuItem">
      <img src="/img/heart.svg" alt="">
      <a href="https://shogosensui.com">Activity</a>
    </div>
    <div class="Header__MenuItem">
      <img src="/img/facebook.svg" alt="">
      <a href="https://www.facebook.com/1000ch.net">Facebook</a>
    </div>
  </nav>
</header>

      <main class="Main">
        <span class="Label Label--gray pull-left">2013.12.26</span>

        

<h1 id="es6のシンタックスを予習復習-1-let-const-arrow-function-generators-for-of">ES6のシンタックスを予習復習(1) ~let, const, Arrow Function, Generators, for of~</h1>

<p>ES6のフォローについては書こうとしていたものの後手に回っていて、ようやく書くに至る。SetやらMapやら、追加クラスのあたりは実装されても試そうとした時にそんなに障壁にならない気がしてるけど、<code>let</code>とか<code>const</code>、アローファンクション等々、シンタックスが関わる辺はつっかえ棒になりかねないので消化しておく。</p>

<h2 id="この段階での実装状況はnightly-canary">この段階での実装状況はNightly &gt; Canary</h2>

<ul>
<li>Chrome Canary 34.0.1760.0</li>
<li>Firefox Nightly 29.0a1 (2013-12-25)</li>
</ul>

<p>この2つを<a href="http://kangax.github.io/es5-compat-table/es6/">ECMAScript 6 compatibility table</a>で比較するとNightlyのほうが先行実装は進んでいるのでNightlyでアレコレする。Canaryだと試したいシンタックス部分がまだ実装されていないので断念。</p>

<p>Canaryでデバッグしたい人はES6実装を有効にするフラグをたてる必要があるので、<code>chrome://flags</code>にアクセスして<code>#enable-javascript-harmony</code>でページを検索すると <strong>JavaScript の試験運用機能を有効にする</strong> という項目があるのでそれを有効にする。あとはDevTool開いてConsoleでいつも通り試せる。が、今回はFirefoxなのでScratchpadでやる。使い慣れてない…。</p>

<h2 id="let"><code>let</code></h2>

<p><code>let</code>を使うことでブロックスコープの変数宣言が可能になる。</p>

<p>まず、今までの<code>var</code>を使ったパターン。（これだとそもそもlintで怒られるけど、挙動のテストということで。）</p>

<pre><code class="language-js">var x = 1;
if (true) {
  var x = 2;
  console.log('x is ' + x);
  // x is 2
}
console.log('x is ' + x);
// x is 2
</code></pre>

<p>このケースだと最初に宣言した<code>x</code>がif内で上書きされ、2回とも2が出力される。ここで<code>let</code>を使ってみる。</p>

<pre><code class="language-js">let x = 1;
if (true) {
  let x = 2;
  console.log('x is ' + x);
  // x is 2
}
console.log('x is ' + x);
// x is 1
</code></pre>

<p>期待通りの動きをしてくれる。<code>var</code>と<code>let</code>の複合はどうなるか。</p>

<pre><code class="language-js">let x = 1;
if (true) {
  var x = 2;
  console.log('x is ' + x);
  // x is 2
}
console.log('x is ' + x);
// x is 2
</code></pre>

<p><code>var</code>はスコープの外の<code>let</code>を上書いてしまうらしい。</p>

<pre><code class="language-js">var x = 1;
if (true) {
  let x = 2;
  console.log('x is ' + x);
  // x is 2
}
console.log('x is ' + x);
// x is 1
</code></pre>

<p>こっちはスコープを守ってくれている。<code>var</code>の使用頻度えらく減る予感…。おなじみのスコープ形成無名関数も減るのかな、と。なんか<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/ECMAScript_6_support_in_Mozilla">Firefoxの現在の実装は仕様とちょっと違うらしい</a>。</p>

<h2 id="const"><code>const</code></h2>

<p><code>const</code>もES6から追加される新しい変数宣言の方法で、定数値(constant value)を宣言する時に使用する。<code>const</code>を使って宣言された変数には値を代入できなくなる。</p>

<pre><code class="language-js">const PI = 3.14;
PI = 3;
console.log('PI is ' + PI);
// PI is 3.14
</code></pre>

<p>こういうのものOK。</p>

<pre><code class="language-js">var x = 3;
var y = 0.14;
const PI = x + y;
PI = 3;
console.log('PI is ' + PI);
// PI is 3.14
</code></pre>

<p><code>use strict</code>をつけてstrictモードになっている場合は、<code>PI = 3;</code>の部分で例外が発生。ちなみにこれはtry/catchでも捕捉出来なかった(?)。</p>

<pre><code class="language-js">&quot;use strict&quot;;
const PI = 3.14;
PI = 3;
// TypeError: PI is read-only
console.log(PI);
// ここまで来ない
</code></pre>

<h2 id="関数のアロー記法">関数のアロー記法</h2>

<p>関数を、<code>function</code>の代わりに<code>=&gt;</code>を使って表現可能になったアレ。CoffeeScriptを連想させられる。</p>

<pre><code class="language-js">const square = function(x) {
  return x * x;
};
const multiply = function(x, y) {
  return x * y;
}
console.log(square(2));
// 4
console.log(multiply(3, 4));
// 12
</code></pre>

<p>これをアロー記法で書くと</p>

<pre><code class="language-js">const square = x =&gt; {
  return x * x;
};
const multiply = (x, y) =&gt; {
  return x * y;
}
console.log(square(2));
// 4
console.log(multiply(3, 4));
// 12
</code></pre>

<p>関数のとる引数がひとつの場合は括弧を省略出来る。<code>this</code>の持ち込みには注意するとして、記法自体は <strong><code>function</code>というキーワードを除いて、引数の括弧の後ろに<code>=&gt;</code>をつける</strong> という覚え方で良いのかな。あとはイベントのコールバックにも書いたり出来そう。</p>

<pre><code class="language-js">document.addEventListener('DOMContentLoaded', e =&gt; {
  console.log(e);
});
// DOMContentLoaded {target: ...}
</code></pre>

<p>C#のラムダ式で妙に親しみがあるのでちょっと懐かしい。そしてJSで書けるのは嬉しい。</p>

<h2 id="generatorsとfor-ofループ">Generatorsとfor ofループ</h2>

<p>Generator Functionは実行された後も実行状態を保持し、イテレータとして使用する。<a href="http://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A3%E3%83%9C%E3%83%8A%E3%83%83%E3%83%81%E6%95%B0">フィボナッチ数列</a>を例に説明。</p>

<pre><code class="language-js">const fibonacci = function* () {
  let prev = 0;
  let curr = 1;
  while (true) {
    prev = curr;
    curr = prev + curr;
    yield curr;
  }
};
// SyntaxError: missing ; before statement
</code></pre>

<p>が、SpiderMonkeyが<code>function*</code>シンタックスに綺麗に対応していない(?)ようで、実行出来なかった。仕方なく以下のように書いた。</p>

<pre><code class="language-js">const fibonacci = function* () {
  var prev = 0;
  var curr = 1;
  var swap = null;
  while (true) {
    swap = curr;
    curr = prev + curr;
    prev = swap;
    yield curr;
  }
};
var seq = fibonacci();
console.log(seq.next()); // {value: 1, done: false}
console.log(seq.next()); // {value: 2, done: false}
console.log(seq.next()); // {value: 3, done: false}
console.log(seq.next()); // {value: 5, done: false}
console.log(seq.next()); // {value: 8, done: false}
</code></pre>

<p>実行するとイテレータオブジェクトを返却して、<code>next()</code>を実行すると値が列挙されていく。これを配列のイテレーションをすることが可能なfor ofループと組み合わせてみる。</p>

<pre><code class="language-js">for (var seq of fibonacci()) {
  if (seq &gt; 1000) {
    break;
  }
  console.log(seq);
}
// 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987
</code></pre>

<p>順番が逆になってしまいましたが、for ofで配列をイテレートすることが可能。今までやっていたfor in + Arrayの罠にハマることがなくなりそう。</p>

<pre><code class="language-js">var array = [1, 10, 100, 1000, 10000];
for (var item of array) {
  console.log(item);
}
// 1, 10, 100, 1000, 10000
</code></pre>

<p>オブジェクトにはイテレータ関数が明示されていないので、そのままだと<code>for of</code>は使えない。なので、イテレータ関数を挟んで<code>for of</code>に列挙させてみる。</p>

<pre><code class="language-js">var data = {
  a: 10,
  b: 20,
  c: 30
};
const valueIterator = function* (object) {
  var keys = Object.keys(object);
  for(var i = 0, len = keys.length;i &lt; len;i++) {
    yield object[keys[i]];
  }
};
for (var item of valueIterator(data)) {
  console.log(item);
}
// 10, 20, 30
</code></pre>

<h2 id="所感">所感</h2>

<p>一番試したかったclassが未実装で書けなかった（ただの糖衣構文だが）。でも実装も色々と進んできているし、試すレベルでは色々と楽しめそうな予感。</p>

<p>ES6をES5にコンパイルしてくれる<a href="https://github.com/google/traceur-compiler">google / traceur-compiler</a>とかもあるが、プロダクトで <strong>「ES6をゴリゴリ使って後方互換にES5ソースを用意する」</strong> みたいなことをするのはちょっとだけ早いかなとは思った。</p>

<p>続き(?)はまた新年。</p>

        <aside class="Share">
  <div class="Share__Item">
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2f1000ch.net%2fposts%2f2013%2fes6-features-1.html" title="Share on Facebook" target="_blank">
      <img src="/img/facebook.svg">
    </a>
  </div>
  <div class="Share__Item">
    <a href="https://twitter.com/share?url=https%3a%2f%2f1000ch.net%2fposts%2f2013%2fes6-features-1.html&text=ES6%e3%81%ae%e3%82%b7%e3%83%b3%e3%82%bf%e3%83%83%e3%82%af%e3%82%b9%e3%82%92%e4%ba%88%e7%bf%92%e5%be%a9%e7%bf%92%281%29%20~let%2c%20const%2c%20Arrow%20Function%2c%20Generators%2c%20for%20of~" title="Share on Twitter" target="_blank">
      <img src="/img/twitter.svg">
    </a>
  </div>
</aside>

<nav class="Pager">
  
    <div class="Pager__Item Pager__Item--left">
      <a href="/posts/2013/sacss-follow-up.html">👈 SaCSS SP4 Frontrend in Sapporoでリファクタリングについて話してきた</a>
    </div>
  

  
    <div class="Pager__Item Pager__Item--right">
      <a href="/posts/2013/es6-features-2.html">ES6のシンタックスを予習復習(2) ~Default Parameters, Rest Parameters, Array Spread, Destructuring~ 👉</a>
    </div>
  
</nav>

      </main>
      <aside class="Aside">
  <h1>Author</h1>
  <div class="Media">
    <picture>
      <source srcset="/img/1000ch.webp" type="image/webp">
      <img class="Media__Figure" src="/img/1000ch.jpg" alt="">
    </picture>
    <div class="Media__Body">
      <h3 class="Media__Title">1000ch <a href="https://twitter.com/1000ch" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @1000ch</a></h3>
      <p>
        ソフトウェアエンジニア。SIer でのプログラマーを経て Web 業界に転職して以来、Web 技術に没頭する日々を送っている。Web 標準の動向やアーキテクチャの流行を追いかけつつ、技術啓蒙や OSS 活動に励んでいる。
      </p>
    </div>
  </div>
</aside>

      <footer class="Footer">
  <div class="Banner">
    <div class="Banner__Item">
      <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.ja" target="_blank">
        <img src="/img/by-nc-nd.png" alt="CC BY-NC-ND 4.0" width="80" height="28">
      </a>
    </div>
    <div class="Banner__Item">
      <a href="https://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fhttps%3A%2F%2F1000ch.net%2Findex.xml" target="_blank">
        <img src="https://s3.feedly.com/img/follows/feedly-follow-rectangle-flat-medium_2x.png" alt="follow me on feedly" width="71" height="28">
      </a>
    </div>
    <div class="Banner__Item">
      <form action="https://duckduckgo.com/" role="search">
        <input name="sites" type="hidden" value="1000ch.net">
        <input name="q" type="search">
        <input type="submit" value="Search">
      </form>
    </div>
  </div>
</footer>

    </div>
    <script defer src="https://platform.twitter.com/widgets.js"></script>
<script defer src="https://platform.instagram.com/en_US/embeds.js"></script>
<script defer src="https://assets.codepen.io/assets/embed/ei.js"></script>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
<script type="module">
import AffiliateLink from '/js/affiliate-link.js';
import FluidIframe from 'https://cdn.jsdelivr.net/npm/fluid-iframe/dist/index.js';

customElements.define('affiliate-link', AffiliateLink);
customElements.define('fluid-iframe', FluidIframe);

document.querySelectorAll('pre code').forEach(block => {
  hljs.highlightBlock(block);
});

if (navigator.serviceWorker) {
  navigator.serviceWorker.register('/sw.js');
}
</script>

  </body>
</html>
