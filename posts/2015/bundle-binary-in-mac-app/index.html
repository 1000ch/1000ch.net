<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Macã®ã‚¢ãƒ—ãƒªã«ãƒã‚¤ãƒŠãƒªã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ - EagleLand</title>
<link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.png><link rel="shortcut icon" href=/favicon.svg type=image/svg+xml sizes=any><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/dracula.min.css><link rel=stylesheet href=/css/settings.css><link rel=stylesheet href=/css/tools.css><link rel=stylesheet href=/css/generic.css><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/objects.css><link rel=stylesheet href=/css/components.css><link rel=stylesheet href=/css/trumps.css><link rel=alternate href=/rss.xml title=1000ch.net type=application/rss+xml><meta name=author content="Shogo Sensui"><meta name=copyright content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan"><meta property="og:description" content='WebPonizeã«ã¯ç”»åƒã‚’WebPãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ã€WebM Projectã«ã¦é…å¸ƒã•ã‚Œã¦ã„ã‚‹WebPã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¾¤ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã€‚
A new image format for the Web - WebP â€” Google Developers cwebpã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ å®Ÿè¡Œå¯èƒ½å½¢å¼ã®cwebpã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é…ç½®ã—ã¦ã€Swiftã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã€‚ãƒãƒ³ãƒ‰ãƒ«ã•ã‚ŒãŸcwebpã¸ã®å‚ç…§ã¯NSBundleã‚’ã€å®Ÿè¡Œã¯NSTaskã‚’ä½¿ãˆã°ã§ãã‚‹ã€‚ä»¥ä¸‹ã®æ§˜ãªé›°å›²æ°—ã€‚
func execute() -> String { let task = NSTask() let pipe = NSPipe() task.launchPath = bundle.pathForResource("cwebp", ofType: "") task.currentDirectoryPath = "~" task.arguments = "-q 80 input.png -o output.webp" task.standardOutput = pipe task.launch() let data = pipe.fileHandleForReading.readDataToEndOfFile() return NSString(data: data, encoding: NSUTF8StringEncoding)! } iTunes Connectã«submitã§ããªã„ ã„ã–Macã®ã‚¹ãƒˆã‚¢ã«submitã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€åŒæ¢±ç‰©ã«å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã®ã§æ€’ã‚‰ã‚Œã‚‹ã€‚å³å¯†ã«è¨€ãˆã°ã€ãã®å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚è‡ªåˆ†ï¼ˆã“ã“ã§ã¯ç§ï¼‰ãŒæ›¸ã„ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸€éƒ¨ã ã¨ã„ã†ã“ã¨ã‚’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«è¨¼æ˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã‚ˆãã‚ˆãè€ƒãˆã¦ã¿ã‚Œã°æ­£ä½“ä¸æ˜ãªå®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã§ãã¦ã—ã¾ã£ãŸã‚‰å¤§å¤‰ãªã“ã¨ã«ãªã‚Šãã†ã ã€‚ç´å¾—ã€‚
è‡ªåˆ†ã§æ›¸ã„ã¦ã„ã‚‹Swiftã®ã‚³ãƒ¼ãƒ‰ï¼ˆã¨ã„ã†ã‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸæˆæœç‰©ï¼‰ã«å¯¾ã—ã¦ã¯Code Signã¨å‘¼ã°ã‚Œã‚‹Macã®ãƒ‡ã‚£ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã¨ã—ã¦iTunes Connectã«ç™»éŒ²ã™ã‚‹ã¨å¾—ã‚‰ã‚Œã‚‹è¨¼æ˜æ›¸ãŒã€XcodeãŒãƒ“ãƒ«ãƒ‰æ™‚ã«ä»˜ä¸ã•ã‚Œã‚‹ã€‚
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆãƒã‚¤ãƒŠãƒªã¸ã®Code Sign cwebpã«è‡ªåˆ†ã®Code Signã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒè‰¯ã„äº‹ã‹æ‚ªã„äº‹ã‹ã¯ä¸€æ—¦ç½®ã„ã¦ãŠã„ã¦ã€ã§ãã‚‹ã‹ã©ã†ã‹è©¦ã—ãŸã€‚
$ codesign --entitlements .'><meta property="og:image" content="https://1000ch.net//img/apple-touch-icon.png"><meta name=twitter:card content="summary"><meta property="og:type" content="article"><meta property="og:url" content="https://1000ch.net/posts/2015/bundle-binary-in-mac-app/"><meta property="og:site_name" content="EagleLand"><meta property="og:title" content="Macã®ã‚¢ãƒ—ãƒªã«ãƒã‚¤ãƒŠãƒªã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹"><meta name=twitter:site content="@1000ch"><meta name=twitter:url content="https://1000ch.net/posts/2015/bundle-binary-in-mac-app/"><meta name=twitter:title content="Macã®ã‚¢ãƒ—ãƒªã«ãƒã‚¤ãƒŠãƒªã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹"><meta name=google-site-verification content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-49530352-1","1000ch.net"),ga("send","pageview")</script></head><body><div class=container><header class=header><h1 class=header-title><a href=/><img src=/img/icon.svg>
<span>EagleLand</span></a></h1><nav><a href=/rss.xml>ğŸ“» RSS</a>
<a href="https://www.google.co.jp/search?q=site%3A1000ch.net">ğŸ” æ¤œç´¢</a>
<a href=https://shogosensui.com>ğŸŒ Author</a></nav></header><main class=main><h1>Macã®ã‚¢ãƒ—ãƒªã«ãƒã‚¤ãƒŠãƒªã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹</h1><p style=margin:0;text-align:right>Published at 2015-03-21</p><p><a href=/posts/2015/weponize.html>WebPonize</a>ã«ã¯ç”»åƒã‚’WebPãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ã€WebM Projectã«ã¦é…å¸ƒã•ã‚Œã¦ã„ã‚‹WebPã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¾¤ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã€‚</p><ul><li><a href="https://developers.google.com/speed/webp/?csw=1">A new image format for the Web - WebP â€” Google Developers</a></li></ul><h2 id=cwebpã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ><code>cwebp</code>ã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h2><p>å®Ÿè¡Œå¯èƒ½å½¢å¼ã®<code>cwebp</code>ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é…ç½®ã—ã¦ã€Swiftã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã€‚ãƒãƒ³ãƒ‰ãƒ«ã•ã‚ŒãŸ<code>cwebp</code>ã¸ã®å‚ç…§ã¯<code>NSBundle</code>ã‚’ã€å®Ÿè¡Œã¯<code>NSTask</code>ã‚’ä½¿ãˆã°ã§ãã‚‹ã€‚ä»¥ä¸‹ã®æ§˜ãªé›°å›²æ°—ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>() -&gt; String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> task = NSTask()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> pipe = NSPipe()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    task.launchPath = bundle.pathForResource(<span style=color:#e6db74>&#34;cwebp&#34;</span>, ofType: <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    task.currentDirectoryPath = <span style=color:#e6db74>&#34;~&#34;</span>
</span></span><span style=display:flex><span>    task.arguments = <span style=color:#e6db74>&#34;-q 80 input.png -o output.webp&#34;</span>
</span></span><span style=display:flex><span>    task.standardOutput = pipe
</span></span><span style=display:flex><span>    task.launch()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> data = pipe.fileHandleForReading.readDataToEndOfFile()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> NSString(data: data, encoding: NSUTF8StringEncoding)<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=itunes-connectã«submitã§ããªã„>iTunes Connectã«submitã§ããªã„</h2><p>ã„ã–Macã®ã‚¹ãƒˆã‚¢ã«submitã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€åŒæ¢±ç‰©ã«å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã®ã§æ€’ã‚‰ã‚Œã‚‹ã€‚å³å¯†ã«è¨€ãˆã°ã€ãã®å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚è‡ªåˆ†ï¼ˆã“ã“ã§ã¯ç§ï¼‰ãŒæ›¸ã„ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸€éƒ¨ã ã¨ã„ã†ã“ã¨ã‚’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«è¨¼æ˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã‚ˆãã‚ˆãè€ƒãˆã¦ã¿ã‚Œã°æ­£ä½“ä¸æ˜ãªå®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã§ãã¦ã—ã¾ã£ãŸã‚‰å¤§å¤‰ãªã“ã¨ã«ãªã‚Šãã†ã ã€‚ç´å¾—ã€‚</p><p>è‡ªåˆ†ã§æ›¸ã„ã¦ã„ã‚‹Swiftã®ã‚³ãƒ¼ãƒ‰ï¼ˆã¨ã„ã†ã‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸæˆæœç‰©ï¼‰ã«å¯¾ã—ã¦ã¯Code Signã¨å‘¼ã°ã‚Œã‚‹Macã®ãƒ‡ã‚£ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã¨ã—ã¦iTunes Connectã«ç™»éŒ²ã™ã‚‹ã¨å¾—ã‚‰ã‚Œã‚‹è¨¼æ˜æ›¸ãŒã€XcodeãŒãƒ“ãƒ«ãƒ‰æ™‚ã«ä»˜ä¸ã•ã‚Œã‚‹ã€‚</p><h2 id=ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆãƒã‚¤ãƒŠãƒªã¸ã®code-sign>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆãƒã‚¤ãƒŠãƒªã¸ã®Code Sign</h2><p><code>cwebp</code>ã«è‡ªåˆ†ã®Code Signã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒè‰¯ã„äº‹ã‹æ‚ªã„äº‹ã‹ã¯ä¸€æ—¦ç½®ã„ã¦ãŠã„ã¦ã€ã§ãã‚‹ã‹ã©ã†ã‹è©¦ã—ãŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ codesign --entitlements ./cwebp.entitlements -s <span style=color:#e6db74>&#34;ç™»éŒ²ã—ã¦ã‚ã‚‹ãƒ‡ã‚£ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼å&#34;</span> ./cwebp
</span></span><span style=display:flex><span>$ codesign --display --entitlements - ./cwebp
</span></span></code></pre></div><p>ç„¡äº‹ã«(?)ä»˜ä¸ã§ããŸã€‚</p><p><code>cwebp</code>ã«Code SignãŒä»˜ä¸ã•ã‚ŒãŸçŠ¶æ…‹ã§Macã®ã‚¹ãƒˆã‚¢ã«submitã§ãã‚‹ã‹ã©ã†ã‹è©¦ã—ãŸãŒã€ã§ããªã‹ã£ãŸã€‚ä»Šå›ã¯<code>cwebp</code>ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã®ã‚‚ã®ã§è©¦ã—ãŸã‘ã©ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰makeã™ã‚‹é€”ä¸­ã§ã‚„ã£ã¦ã‚‚ãŸã¶ã‚“åŒã˜ã“ã¨ã«ãªã‚‹ã¨æ€ã†ã€‚äºˆæƒ³ã ã‘ã©ã€‚</p><p>ãƒã‚¤ãƒŠãƒªã¨Code Signã®é–¢ä¿‚ã«ã¤ã„ã¦ã¯ã€ImageAlphaã‚„ImageOptimã‚‚åŒã˜ã“ã¨ãŒè©²å½“ã—ã¦ã„ã‚‹ã¨äºˆæƒ³ã—ã¦ã„ã‚‹ã€‚ImageAlphaã¯<code>pngquant</code>ã€ImageOptimã¯<code>optipng</code>ã‚„ã‚‰<code>jpegoptim</code>ãã®ä»–ã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã„ã‚‹ãŒã€ãã‚Œã‚‰ã®ãƒã‚¤ãƒŠãƒªã¯Macã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã‚‹æƒ³å®šã®Objective-C / Swiftã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã„ã†ã‚ã‘ã§ã¯ãªã„ã€‚</p><p>ã¡ãªã¿ã«ã€ã‚¹ãƒˆã‚¢ã¸ã®submitãŒã§ããªã‹ã£ãŸã ã‘ã§<code>.app</code>å½¢å¼ã¸ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯å¯èƒ½ã€‚ã“ã®å ´åˆã€è¡¨é¢ä¸Šã¯æ­£ä½“ä¸æ˜ã®ãƒã‚¤ãƒŠãƒªã‚’å«ã‚“ã§ã„ã‚‹ã‚¢ãƒ—ãƒªã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚WebPã¸ã®ã‚³ãƒ³ãƒãƒ¼ãƒˆï¼ˆ<code>cwebp</code>ã®å®Ÿè¡Œï¼‰ã‚‚æ­£å¸¸ã«è¡Œã‚ã‚Œã‚‹ã“ã¨ã‹ã‚‰ã€ImageAlphaã‚„ImageOptimã¯Webã‹ã‚‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã‚‹é…å¸ƒå½¢å¼ã‚’ã¨ã£ã¦ã„ã‚‹ã‚“ã ã¨æ€ã†ã€‚äºˆæƒ³ã ã‘ã©ã€‚</p><h2 id=libwebpaã‚’ãƒªãƒ³ã‚¯ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ><code>libwebp.a</code>ã‚’ãƒªãƒ³ã‚¯ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h2><p><code>cwebp</code>ã¯å®Ÿè¡Œå¯èƒ½å½¢å¼ã ã‘ã©ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ãŸã‚ã®<code>libwebp.a</code>ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ï¼ˆ<code>encode.h</code>ã€<code>decode.h</code>ãªã©ï¼‰ã‚‚é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã€‚</p><ul><li><a href=https://developers.google.com/speed/webp/download>Downloading and Installing WebP - WebP â€” Google Developers</a></li></ul><p>ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Xcodeã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã—ãŸã‚ã¨ã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€<code>encode.h</code>ã¨<code>decode.h</code>ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚<code>libwebp.a</code>ã¸ã®ãƒªãƒ³ã‚¯ã¯è‡ªå‹•ã§è¡Œã‚ã‚ŒãŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-h data-lang=h><span style=display:flex><span><span style=color:#75715e>#ifndef SampleApp_libwebp_h
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define SampleApp_libwebp_h
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#import &#34;libwebp/encode.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#import &#34;libwebp/decode.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span></code></pre></div><p>ä½œæˆã—ãŸã‚‰ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã® <strong>Build Settings</strong> â†’ <strong>Swift Compiler - Code Generation</strong> â†’ <strong>Objective-C Bridging Header</strong> ã«ä½œæˆã—ãŸãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã€‚</p><p><img src=./xcode.png alt></p><p>å…ˆç¨‹ã®ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã£ã½ãå®Ÿè¡Œã™ã‚‹ã‚ã‘ã§ã¯ãªãã€ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹æ§‹é€ ä½“ã«æ²¿ã£ã¦WebPã¸ã®å¤‰æ›ä½œæ¥­ã‚’ã™ã‚‹ã€‚</p><ul><li><a href=https://developers.google.com/speed/webp/docs/api>WebP API Documentation - WebP â€” Google Developers</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> image: CGImage? = getCGImage(image)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> provider: CGDataProviderRef = CGImageGetDataProvider(image)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> bitmap: CFDataRef = CGDataProviderCopyData(provider)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> rgb: UnsafePointer&lt;UInt8&gt; = CFDataGetBytePtr(bitmap)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> width: Int32 = Int32(image.size.width)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> height: Int32 = Int32(image.size.height)
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> stride: Int32 = Int32(CGImageGetBytesPerRow(image))
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> qualityFactor: Float = Float(<span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> webp: NSData
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> output: UnsafeMutablePointer&lt;UInt8&gt; = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> size: size_t = WebPEncodeRGBA(rgb, width, height, stride, qualityFactor, &amp;output)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>webp = NSData(bytes: output, length: Int(size))
</span></span><span style=display:flex><span>webp.writeToFile(<span style=color:#66d9ef>self</span>.saveFilePath, atomically: <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>free(output)
</span></span></code></pre></div><p>ã“ã‚Œãªã‚‰ã°æ‰‹å…ƒã§ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§Code SignãŒä»˜ä¸ã•ã‚Œã‚‹ã€‚ã‚¹ãƒˆã‚¢ã¸ã®submitã‚‚ã§ããŸã€‚</p><aside class=share><p><button type=button id=share-button>ğŸ”— ã“ã®è¨˜äº‹ã‚’ã‚·ã‚§ã‚¢ã™ã‚‹</a></p></aside><div popover=auto id=popover>ã‚¿ã‚¤ãƒˆãƒ«ã¨ URL ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div><nav class=pager><div><a href=/posts/2015/bose-soundlink-mini/>ğŸ‘ˆ BOSE SoundLink Mini</a></div><div><a href=/posts/2015/hugo-boilerplate/>Hugo Boilerplate ğŸ‘‰</a></div></nav></main><aside class=aside></aside><footer class=footer><h2>Preference</h2><div class=preference><label><input type=checkbox switch id=auto-phrase> æ—¥æœ¬èªã®ãƒ•ãƒ¬ãƒ¼ã‚ºæ”¹è¡Œ
</label><label><input type=checkbox switch id=dark-mode> ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</label></div></footer></div><script defer src=https://platform.twitter.com/widgets.js></script><script defer src=https://platform.instagram.com/en_US/embeds.js></script><script defer src=https://strava-embeds.com/embed.js></script><script defer src=https://embed.bsky.app/static/embed.js></script><script type=module>
import hljs from 'https://unpkg.com/@highlightjs/cdn-assets@11.9.0/es/highlight.min.js';

document.querySelectorAll('pre code').forEach(block => {
  hljs.highlightBlock(block);
});
</script><script type=module>
import AffiliateLink from '/js/affiliate-link.js';

customElements.define('affiliate-link', AffiliateLink);

const autoPhrase = document.querySelector('#auto-phrase');
const darkMode =  document.querySelector('#dark-mode');
autoPhrase.checked = localStorage.getItem('auto-phrase');
darkMode.checked = localStorage.getItem('dark-mode');

autoPhrase?.addEventListener('change', event => {
  if (event.target.checked) {
    localStorage.setItem('auto-phrase', true);
  } else {
    localStorage.removeItem('auto-phrase');
  }
});

darkMode?.addEventListener('change', event => {
  if (event.target.checked) {
    localStorage.setItem('dark-mode', true);
  } else {
    localStorage.removeItem('dark-mode');
  }
});

const shareButton = document.querySelector('.share button');
shareButton?.addEventListener('click', async event => {
  event.preventDefault();

  const data = {
    title: document.title,
    text: document.title,
    url: location.href
  };

  if (navigator.canShare?.(data)) {
    await navigator.share(data);
  } else {
    await navigator.clipboard?.writeText(`${data.title} ${data.url}`);
    const popover = document.querySelector('#Popover');
    popover.showPopover();

    setTimeout(() => {
      popover.hidePopover();
    }, 2000);
  }
});
</script></body></html>