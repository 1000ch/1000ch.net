<!doctype html><html lang=ja>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Polymerについての所感 - EagleLand</title>
<link rel=icon href=/favicon.png>
<link rel="shortcut icon" href=/favicon.png>
<link rel="shortcut icon" href=/favicon.svg type=image/svg+xml sizes=any>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/dracula.min.css>
<link rel=stylesheet href=/css/settings.css>
<link rel=stylesheet href=/css/tools.css>
<link rel=stylesheet href=/css/generic.css>
<link rel=stylesheet href=/css/base.css>
<link rel=stylesheet href=/css/objects.css>
<link rel=stylesheet href=/css/components.css>
<link rel=stylesheet href=/css/trumps.css>
<link rel=alternate href=/rss.xml title=1000ch.net type=application/rss+xml>
<meta name=author content="Shogo Sensui">
<meta name=copyright content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan">
<meta property="og:description" content="Polymerについての所感 Polymerを使ったWeb Componentsに<twitter-button>、<facebook-button>、<gplus-one>・<gplus-follow>がある。Polymerのバージョンが古かったのでプルリクエストを送ったんだけど、修正しながら考えてたことを書いてみた。
Polymerに依存するWeb Components Polymerで作ったWeb Componentsは、jQueryとそのプラグインの関係に似てると思ってる。それが配布されることを考えてみよう。
そのコンポーネントのバージョンはPolymerのバージョンに依存することは、使いたいコンポーネントが依存するPolymerが複数存在してしまう可能性を示唆している。Polymerがまだベータ版で後方互換性のない変更が起こる可能性を考えると、依存バージョンがてんでバラバラのWeb Componentsが散乱しかねないんじゃないかと。
実際、Polymerの0.8previewでは、Web Componentsの定義を<polymer-element>ではなく、<template> + <script>に変更するっぽい。この変更については素のWeb Componentsとの互換性を加味したアップデートかもしれないけど、今まで<polymer-element>で作成してきたコンポーネントは早くも埃を被る結果になってしまう。
このように、Polymerを使ったWeb Componentsを配布することには、現段階ではややリスクがあるかなと思っている。ただ、配布はしないにしてもプロダクトには何の躊躇もなく使ってしまいそうではある。
不可能を可能にする ブラウザデフォルトでは実行できなそうなコードもPolymerの手にかかれば動いてしまう。以下の2つを例示。
Shadow DOM配下のlink要素は無効である  7.1 Inert HTML Elements A subset of HTML elements must behave as inert, or not part of the document tree. This is consistent how the HTML elements would behave in a document fragment. These elements are:
 base link  All other HTML elements in the shadow trees must behave as if they were part of the document tree.">
<meta property="og:image" content="https://1000ch.net/img/apple-touch-icon.png">
<meta name=twitter:card content="summary">
<meta property="og:type" content="article">
<meta property="og:url" content="https://1000ch.net/posts/2015/polymer-is.html">
<meta property="og:site_name" content="EagleLand">
<meta property="og:title" content="Polymerについての所感">
<meta name=twitter:site content="@1000ch">
<meta name=twitter:url content="https://1000ch.net/posts/2015/polymer-is.html">
<meta name=twitter:title content="Polymerについての所感">
<meta name=google-site-verification content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y">
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed sizes=114x114 href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed sizes=72x72 href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-49530352-1','1000ch.net'),ga('send','pageview')</script>
</head>
<body>
<div class=Container>
<header class=Header>
<h1 class=Header__Title>
<a href=/>EagleLand</a>
</h1>
<nav class=Header__Menu>
<div class=Header__MenuItem>
<a href=/rss.xml>📻 RSS</a>
</div>
<div class=Header__MenuItem>
<a href="https://www.google.co.jp/search?q=site%3A1000ch.net">🔍 検索</a>
</div>
<div class=Header__MenuItem>
<a href=https://shogosensui.com>🌎 Who is 1000ch</a>
</div>
</nav>
</header>
<main class=Main>
<span class="Label Label--gray pull-left">2015.01.30</span>
<h1 id=polymerについての所感>Polymerについての所感</h1>
<p>Polymerを使ったWeb Componentsに<a href=https://github.com/zenorocha/twitter-button><code>&lt;twitter-button></code></a>、<a href=https://github.com/zenorocha/facebook-button><code>&lt;facebook-button></code></a>、<a href=https://github.com/zenorocha/gplus-elements><code>&lt;gplus-one></code>・<code>&lt;gplus-follow></code></a>がある。Polymerのバージョンが古かったのでプルリクエストを送ったんだけど、修正しながら考えてたことを書いてみた。</p>
<h2 id=polymerに依存するweb-components>Polymerに依存するWeb Components</h2>
<p>Polymerで作ったWeb Componentsは、jQueryとそのプラグインの関係に似てると思ってる。それが配布されることを考えてみよう。</p>
<p>そのコンポーネントのバージョンはPolymerのバージョンに依存することは、使いたいコンポーネントが依存するPolymerが複数存在してしまう可能性を示唆している。Polymerがまだベータ版で後方互換性のない変更が起こる可能性を考えると、依存バージョンがてんでバラバラのWeb Componentsが散乱しかねないんじゃないかと。</p>
<p>実際、Polymerの0.8previewでは、Web Componentsの定義を<code>&lt;polymer-element></code>ではなく、<code>&lt;template></code> + <code>&lt;script></code>に変更するっぽい。この変更については素のWeb Componentsとの互換性を加味したアップデートかもしれないけど、今まで<code>&lt;polymer-element></code>で作成してきたコンポーネントは早くも埃を被る結果になってしまう。</p>
<p>このように、Polymerを使ったWeb Componentsを配布することには、現段階ではややリスクがあるかなと思っている。ただ、配布はしないにしてもプロダクトには何の躊躇もなく使ってしまいそうではある。</p>
<h2 id=不可能を可能にする>不可能を可能にする</h2>
<p>ブラウザデフォルトでは実行できなそうなコードもPolymerの手にかかれば動いてしまう。以下の2つを例示。</p>
<h3 id=shadow-dom配下のlink要素は無効である>Shadow DOM配下のlink要素は無効である</h3>
<blockquote>
<p>7.1 Inert HTML Elements
A subset of HTML elements must behave as inert, or not part of the document tree. This is consistent how the HTML elements would behave in a document fragment. These elements are:</p>
<ul>
<li>base</li>
<li>link</li>
</ul>
<p>All other HTML elements in the shadow trees must behave as if they were part of the document tree.</p>
</blockquote>
<p>via <a href=http://www.w3.org/TR/shadow-dom/#inert-html-elements>http://www.w3.org/TR/shadow-dom/#inert-html-elements</a></p>
<h3 id=extendsにカスタム要素を指定することは出来ない><code>extends</code>にカスタム要素を指定することは出来ない</h3>
<blockquote>
<p>Note the use of extends option to specify that the element is being registered as a type extension &ndash; that is, this element does not introduce a new tag (like the custom tag elements do), but rather extends an existing element of type HTMLParagraphElement. Here&rsquo;s how one could instantiate this element:</p>
</blockquote>
<p>via <a href=http://www.w3.org/TR/custom-elements/#extensions-to-document-interface-to-register>http://www.w3.org/TR/custom-elements/#extensions-to-document-interface-to-register</a></p>
<p>いずれも素のWeb Componentsだと不可能になっているところなのに、<a href=/posts/2014/link-element-in-shadow-dom.html><code>link</code>要素はCSSファイルをリクエストして<code>&lt;style></code>で埋め込み</a>してしまうし、<a href=https://www.polymer-project.org/docs/polymer/polymer.html#extending-other-elements><code>extends</code>にカスタム要素の指定も出来てしまう</a>。</p>
<p>便利な半面、W3Cの仕様と反する挙動でもあるので、ブラウザデフォルトの振る舞いを勘違いすらさせてしまう副作用を感じる。賛否両論というよりは、利用シーンに応じた使い分けの問題であり、つまるところ開発者のリテラシーに行き着いてしまう。</p>
<h2 id=やっぱり便利な付加機能>やっぱり便利な付加機能</h2>
<p>とにかく強い。Web Componentsに何が補強されているかは<a href=http://havelog.ayumusato.com/develop/webcomponents/e603-diff_of_polymer_and_webcomponents.html>Polymer と Web Components の違い9選（もとい Polymer の便利機能）</a>でも言及されているが、そのままでは<del>貧弱</del>シンプルな<code>&lt;template></code>の機能に、Mustacheみたいなテンプレート機能があったり、それがそのままJS側の変数とデータバインディングされていたりと、もはやチートレベルだ。</p>
<p>ライフサイクルコールバックのエイリアスがあったり、各種便利そうなイベントが用意されていたり、カスタム要素の煩雑な定義手順が大幅に簡略化されていたりと。<code>attributes</code>による属性の定義は<code>Object.defineProperty()</code>よりずっと楽ちんだし、わかりやすい。</p>
<p>Webを構築する上で土台になる機能はCore Elementsとしてコンポーネント化されているので、それらを使うことを加味しても素のWeb Componentsだけで設計していくよりはPolymerのお作法に乗っかるほうが安心だし、早いし、楽かと思う。</p>
<h2 id=総論>総論</h2>
<p>ややトゲ混じりの内容になった気もするけど、Polymer（jQuery）を使うことに特に嫌悪感はない。手っ取り早くアレコレするにはやっぱり便利だとは思うので。</p>
<p>APIをラップして補強・簡易化している点は同じ。jQueryと異なるのは、Polymer単体で何か嬉しいのではなく、PolymerでWeb Componentsを作る時に凄く便利であるという点。つまり、jQueryで言うところのプラグインが前提（というか主役）になるところ。</p>
<p>jQueryプラグインは使わないかなーという気持ちなんだけど、Polymer依存のWeb Componentsには今のところ手が伸びる。最初に書いたPolymerのバージョンにまつわる問題がチラホラ出てきたりすると、PolymerもjQueryと同じ道を辿ってしまうのかなという心配もある。</p>
<p>Polymerを使ったコンポーネントを開発し配布する側、古びたコンポーネントを使う側の問題、言ってしまえばそうなんだけど…。</p>
<p>Web Componentsの普及という目的は、きっと果たされるんだろう。</p>
<aside class=Share>
<div class=Share__Item>
<button type=button class=Share__Button>🔗 この記事をシェアする</a>
</div>
</aside>
<div popover=auto id=Popover>タイトルと URL をコピーしました</div>
<nav class=Pager>
<div class="Pager__Item Pager__Item--left">
<a href=/posts/2015/http-spdy-http2.html>👈 HTTP1.1とSPDYとHTTP2</a>
</div>
<div class="Pager__Item Pager__Item--right">
<a href=/posts/2015/hackers-and-painters.html>ハッカーと画家 👉</a>
</div>
</nav>
</main>
<aside class=Aside></aside>
<footer class=Footer style=margin-bottom:2%>
<h1>Author</h1>
<div class=Media>
<picture>
<source srcset=/img/1000ch.avif type=image/avif>
<img class=Media__Figure src=/img/1000ch.jpg alt>
</picture>
<div class=Media__Body>
<h3 class=Media__Title>1000ch <a href=https://twitter.com/1000ch class=twitter-follow-button data-show-count=false data-show-screen-name=false>Follow @1000ch</a></h3>
<p>Web アプリケーション開発を専門とするソフトウェアエンジニア。企業で働く傍ら、技術顧問として複数企業のエンジニアリングに関わり、高品質で維持しやすい Web アプリケーションを作るための活動を続けている。</p>
</div>
</div>
</footer>
</div>
<script defer src=https://platform.twitter.com/widgets.js></script>
<script defer src=https://platform.instagram.com/en_US/embeds.js></script>
<script defer src=https://strava-embeds.com/embed.js></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/highlight.min.js></script>
<script type=module>
import AffiliateLink from '/js/affiliate-link.js';

customElements.define('affiliate-link', AffiliateLink);

document.querySelectorAll('pre code').forEach(block => {
  hljs.highlightBlock(block);
});

document.querySelector('.Share__Item button').addEventListener('click', async event => {
  event.preventDefault();

  const data = {
    title: document.title,
    text: document.title,
    url: location.href
  };

  if (navigator.canShare?.(data)) {
    await navigator.share(data);
  } else {
    await navigator.clipboard?.writeText(`${data.title} ${data.url}`);
    const popover = document.querySelector('#Popover');
    popover.showPopover();

    setTimeout(() => {
      popover.hidePopover();
    }, 2000);
  }
});
</script>
</body>
</html>