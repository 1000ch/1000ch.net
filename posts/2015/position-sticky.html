<!doctype html><html lang=ja>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>position-stickyについて調べたメモ - EagleLand</title>
<link rel=icon href=/favicon.png>
<link rel="shortcut icon" href=/favicon.png>
<link rel="shortcut icon" href=/favicon.svg type=image/svg+xml sizes=any>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/dracula.min.css>
<link rel=stylesheet href=/css/settings.css>
<link rel=stylesheet href=/css/tools.css>
<link rel=stylesheet href=/css/generic.css>
<link rel=stylesheet href=/css/base.css>
<link rel=stylesheet href=/css/objects.css>
<link rel=stylesheet href=/css/components.css>
<link rel=stylesheet href=/css/trumps.css>
<link rel=alternate href=/rss.xml title=1000ch.net type=application/rss+xml>
<meta name=author content="Shogo Sensui">
<meta name=copyright content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan">
<meta property="og:description" content="position-stickyについて調べたメモ 業務中にposition: sticky;的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。
 Fixed-sticky - filamentgroup Demo: Position Sticky  広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されているposition: fixed;と言えばいいんだろうか。
スペックなど  Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012) 6.2. Sticky positioning - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 6.7. Choosing a positioning scheme: position property - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module  仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。
 Why doesn&rsquo;t position: sticky work in Chrome? - Stack Overflow Issue 231752: Meta bug for position:sticky - Chromium Dashboard   Remove position: sticky">
<meta property="og:image" content="https://1000ch.net/img/apple-touch-icon.png">
<meta name=twitter:card content="summary">
<meta property="og:type" content="article">
<meta property="og:url" content="https://1000ch.net/posts/2015/position-sticky.html">
<meta property="og:site_name" content="EagleLand">
<meta property="og:title" content="position-stickyについて調べたメモ">
<meta name=twitter:site content="@1000ch">
<meta name=twitter:url content="https://1000ch.net/posts/2015/position-sticky.html">
<meta name=twitter:title content="position-stickyについて調べたメモ">
<meta name=google-site-verification content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y">
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed sizes=114x114 href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed sizes=72x72 href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-49530352-1','1000ch.net'),ga('send','pageview')</script>
</head>
<body>
<div class=Container>
<header class=Header>
<h1 class=Header__Title>
<a href=/>EagleLand</a>
</h1>
<nav class=Header__Menu>
<div class=Header__MenuItem>
<a href=/rss.xml>📻RSS</a>
</div>
<div class=Header__MenuItem>
<a href="https://www.google.co.jp/search?q=site%3A1000ch.net">🔍検索</a>
</div>
<div class=Header__MenuItem>
<a href=https://shogosensui.com>🌎Who is 1000ch</a>
</div>
</nav>
</header>
<main class=Main>
<span class="Label Label--gray pull-left">2015.03.31</span>
<h1 id=position-stickyについて調べたメモ>position-stickyについて調べたメモ</h1>
<p>業務中に<code>position: sticky;</code>的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。</p>
<ul>
<li><a href=http://filamentgroup.github.io/fixed-sticky/demos/demo.html>Fixed-sticky - filamentgroup</a></li>
<li><a href=http://philipwalton.github.io/polyfill/demos/position-sticky/>Demo: Position Sticky</a></li>
</ul>
<p>広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されている<code>position: fixed;</code>と言えばいいんだろうか。</p>
<h2 id=スペックなど>スペックなど</h2>
<ul>
<li><a href=https://lists.w3.org/Archives/Public/www-style/2012Jun/0627.html>Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012)</a></li>
<li><a href=http://dev.w3.org/csswg/css-position/#sticky-pos>6.2. Sticky positioning</a> - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module</li>
<li><a href=http://dev.w3.org/csswg/css-position/#position-property>6.7. Choosing a positioning scheme: position property</a> - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module</li>
</ul>
<p>仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。</p>
<ul>
<li><a href=http://stackoverflow.com/questions/15646747/why-doesnt-position-sticky-work-in-chrome>Why doesn&rsquo;t position: sticky work in Chrome?</a> - Stack Overflow</li>
<li><a href="https://code.google.com/p/chromium/issues/detail?id=231752">Issue 231752: Meta bug for position:sticky</a> - Chromium Dashboard</li>
</ul>
<blockquote>
<p>Remove position: sticky</p>
<p>We would eventually like to implement position: sticky, but the current implementation isn&rsquo;t designed in a way that integrates well with the existing scrolling and compositing system. For example, position: sticky relies upon <code>updateLayerPositionsAfterDocumentScroll</code> to function correctly, but that function has no other purpose and can otherwise be removed. Similarly, <code>position: sticky</code> doesn&rsquo;t work at all with composited overflow scrolling, which is now the default mechanism for driving scrolling in the engine.</p>
<p>Once we&rsquo;ve got our scrolling and compositing house in order, we should return to position: sticky and implement the feature in a way that integrates well with the rest of the engine. For now, however, this CL removes our current implementation so we can focus on improving our implementation of the scrolling
features we&rsquo;ve already shipped.</p>
</blockquote>
<p>だそうです。待ちましょう。</p>
<h3 id=feature-detectionの方法>Feature Detectionの方法</h3>
<p>スニペット的な。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>div</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#34;div&#34;</span>);
<span style=color:#a6e22e>div</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sticky&#34;</span>;
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>div</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;sticky&#34;</span>) <span style=color:#f92672>!==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</code></pre></div><h2 id=javascriptでエミュレーション>JavaScriptでエミュレーション</h2>
<p>結論、2015年3月末の段階では<a href="http://caniuse.com/#search=sticky">ブラウザ対応がイマイチ</a>なのでJavaScriptでアレコレする必要がある。以下は有名処の実装。いずれもjQueryのプラグイン。</p>
<ul>
<li><a href=https://github.com/filamentgroup/fixed-sticky>filamentgroup/fixed-sticky</a> filament groupによる実装</li>
<li><a href=https://github.com/philipwalton/polyfill/tree/master/demos/position-sticky>philipwalton/polyfill</a> Philip Waltonによる実装</li>
</ul>
<p>jQuery非依存が良かったので自分で書き直した。</p>
<ul>
<li><a href=https://github.com/1000ch/position-sticky>1000ch/position-sticky</a></li>
</ul>
<p>はじめはPhilip Waltonの実装と同じように、stickyとしたい要素をクローン→クローンした要素に<code>position: fixed;</code>を適用→クローン元を<code>visiblity: hidden;</code>のような処理をしていたけど、対象要素に自動再生される<code>&lt;video autoplay></code>があったりすると、もろともクローンされてしまい動画が2つ再生されてしまうといったような不都合があったのでクローンしないように実装を直してある。</p>
<p>工夫を凝らしている最中だが、こういうレイアウトに関する記述はCSSにある方が精神衛生的に良いし、メディアクエリと連携させる場合の面倒臭さはどうしてもあるので、やはりブラウザネイティブの欲しいなと思ったのでした。普通だ。</p>
<p>そんだけ。</p>
<aside class=Share>
<div class=Share__Item>
<a href=https://1000ch.net/posts/2015/position-sticky.html title="position-stickyについて調べたメモ - EagleLand">🔗 この記事をシェアする</a>
</div>
</aside>
<nav class=Pager>
<div class="Pager__Item Pager__Item--left">
<a href=/posts/2015/html-css-common-sense.html>👈 現場のプロが教えるHTML+CSSコーディングの最新常識</a>
</div>
<div class="Pager__Item Pager__Item--right">
<a href=/posts/2015/dotfiles.html>dotfilesを整理した 👉</a>
</div>
</nav>
</main>
<aside class=Aside></aside>
<footer class=Footer style=margin-bottom:2%>
<h1>Author</h1>
<div class=Media>
<picture>
<source srcset=/img/1000ch.avif type=image/avif>
<img class=Media__Figure src=/img/1000ch.jpg alt>
</picture>
<div class=Media__Body>
<h3 class=Media__Title>1000ch <a href=https://twitter.com/1000ch class=twitter-follow-button data-show-count=false data-show-screen-name=false>Follow @1000ch</a></h3>
<p>Web アプリケーション開発を専門とするソフトウェアエンジニア。企業で働く傍ら、技術顧問として複数企業のエンジニアリングに関わり、高品質で維持しやすい Web アプリケーションを作るための活動を続けている。</p>
</div>
</div>
</footer>
</div>
<script defer src=https://platform.twitter.com/widgets.js></script>
<script defer src=https://platform.instagram.com/en_US/embeds.js></script>
<script defer src=https://strava-embeds.com/embed.js></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/highlight.min.js></script>
<script type=module>
import AffiliateLink from '/js/affiliate-link.js';

customElements.define('affiliate-link', AffiliateLink);

document.querySelectorAll('pre code').forEach(block => {
  hljs.highlightBlock(block);
});

document.querySelector('.Share__Item a').addEventListener('click', async event => {
  event.preventDefault();

  const shareData = {
    title: document.title,
    url: location.href
  };

  if (navigator.canShare(shareData)) {
    await navigator.share(shareData);
  }
});
</script>
</body>
</html>