<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>position-stickyについて調べたメモ - EagleLand</title>
<link rel=manifest href=manifest.json><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.png><link rel="shortcut icon" href=/favicon.svg type=image/svg+xml sizes=any><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/a11y-dark.min.css><link rel=stylesheet href=/css/settings.css><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/layout.css><link rel=stylesheet href=/css/components.css><link rel=alternate href=/rss.xml title=1000ch.net type=application/rss+xml><meta name=author content="Shogo Sensui"><meta name=copyright content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan"><meta property="og:description" content="業務中にposition: sticky;的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。
Fixed-sticky - filamentgroup Demo: Position Sticky 広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されているposition: fixed;と言えばいいんだろうか。
スペックなど Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012) 6.2. Sticky positioning - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 6.7. Choosing a positioning scheme: position property - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。
Why doesn&rsquo;t position: sticky work in Chrome? - Stack Overflow Issue 231752: Meta bug for position:sticky - Chromium Dashboard Remove position: sticky"><meta property="og:image" content="https://1000ch.net//img/apple-touch-icon.png"><meta name=twitter:card content="summary"><meta property="og:type" content="article"><meta property="og:url" content="https://1000ch.net/posts/2015/position-sticky/"><meta property="og:site_name" content="EagleLand"><meta property="og:title" content="position-stickyについて調べたメモ"><meta name=twitter:site content="@1000ch"><meta name=twitter:url content="https://1000ch.net/posts/2015/position-sticky/"><meta name=twitter:title content="position-stickyについて調べたメモ"><meta name=google-site-verification content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-49530352-1","1000ch.net"),ga("send","pageview")</script></head><body><div class=container><header class=header><h1 class=header-title><a href=/><img src=/img/icon.svg>
<span>EagleLand</span></a></h1><nav><a href=/rss.xml>📻 RSS</a>
<a href="https://www.google.co.jp/search?q=site%3A1000ch.net">🔍 検索</a>
<a href=https://shogosensui.com>🌎 Author</a></nav></header><main class=main><h1>position-stickyについて調べたメモ</h1><p style=margin:0;text-align:right>Published at 2015-03-31</p><p>業務中に<code>position: sticky;</code>的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。</p><ul><li><a href=http://filamentgroup.github.io/fixed-sticky/demos/demo.html>Fixed-sticky - filamentgroup</a></li><li><a href=http://philipwalton.github.io/polyfill/demos/position-sticky/>Demo: Position Sticky</a></li></ul><p>広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されている<code>position: fixed;</code>と言えばいいんだろうか。</p><h2 id=スペックなど>スペックなど</h2><ul><li><a href=https://lists.w3.org/Archives/Public/www-style/2012Jun/0627.html>Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012)</a></li><li><a href=http://dev.w3.org/csswg/css-position/#sticky-pos>6.2. Sticky positioning</a> - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module</li><li><a href=http://dev.w3.org/csswg/css-position/#position-property>6.7. Choosing a positioning scheme: position property</a> - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module</li></ul><p>仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。</p><ul><li><a href=http://stackoverflow.com/questions/15646747/why-doesnt-position-sticky-work-in-chrome>Why doesn&rsquo;t position: sticky work in Chrome?</a> - Stack Overflow</li><li><a href="https://code.google.com/p/chromium/issues/detail?id=231752">Issue 231752: Meta bug for position:sticky</a> - Chromium Dashboard</li></ul><blockquote><p>Remove position: sticky</p><p>We would eventually like to implement position: sticky, but the current implementation isn&rsquo;t designed in a way that integrates well with the existing scrolling and compositing system. For example, position: sticky relies upon <code>updateLayerPositionsAfterDocumentScroll</code> to function correctly, but that function has no other purpose and can otherwise be removed. Similarly, <code>position: sticky</code> doesn&rsquo;t work at all with composited overflow scrolling, which is now the default mechanism for driving scrolling in the engine.</p><p>Once we&rsquo;ve got our scrolling and compositing house in order, we should return to position: sticky and implement the feature in a way that integrates well with the rest of the engine. For now, however, this CL removes our current implementation so we can focus on improving our implementation of the scrolling
features we&rsquo;ve already shipped.</p></blockquote><p>だそうです。待ちましょう。</p><h3 id=feature-detectionの方法>Feature Detectionの方法</h3><p>スニペット的な。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>div</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#34;div&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>div</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sticky&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>div</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;sticky&#34;</span>) <span style=color:#f92672>!==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span></code></pre></div><h2 id=javascriptでエミュレーション>JavaScriptでエミュレーション</h2><p>結論、2015年3月末の段階では<a href="http://caniuse.com/#search=sticky">ブラウザ対応がイマイチ</a>なのでJavaScriptでアレコレする必要がある。以下は有名処の実装。いずれもjQueryのプラグイン。</p><ul><li><a href=https://github.com/filamentgroup/fixed-sticky>filamentgroup/fixed-sticky</a> filament groupによる実装</li><li><a href=https://github.com/philipwalton/polyfill/tree/master/demos/position-sticky>philipwalton/polyfill</a> Philip Waltonによる実装</li></ul><p>jQuery非依存が良かったので自分で書き直した。</p><ul><li><a href=https://github.com/1000ch/position-sticky>1000ch/position-sticky</a></li></ul><p>はじめはPhilip Waltonの実装と同じように、stickyとしたい要素をクローン→クローンした要素に<code>position: fixed;</code>を適用→クローン元を<code>visiblity: hidden;</code>のような処理をしていたけど、対象要素に自動再生される<code>&lt;video autoplay></code>があったりすると、もろともクローンされてしまい動画が2つ再生されてしまうといったような不都合があったのでクローンしないように実装を直してある。</p><p>工夫を凝らしている最中だが、こういうレイアウトに関する記述はCSSにある方が精神衛生的に良いし、メディアクエリと連携させる場合の面倒臭さはどうしてもあるので、やはりブラウザネイティブの欲しいなと思ったのでした。普通だ。</p><p>そんだけ。</p><aside class=share><button type=button id=share-button>🔗 この記事をシェアする</button>
<a href=https://github.com/1000ch/1000ch.net/edit/main/content/posts/2015/position-sticky.md>🔗 この記事を GitHub で編集する</a></aside><div popover=auto id=popover>タイトルと URL をコピーしました</div><nav class=pager><div><a href=/posts/2015/html-css-common-sense/>👈 現場のプロが教えるHTML+CSSコーディングの最新常識</a></div><div><a href=/posts/2015/dotfiles/>dotfilesを整理した 👉</a></div></nav></main><aside class=aside></aside><footer class=footer><h2>Preference</h2><div class=preference><label><input type=checkbox switch id=auto-phrase> 日本語のフレーズ改行
</label><label><input type=checkbox switch id=dark-mode> ダークモード</label></div><h2>Notice</h2><ul class=notice><li>コンテンツの正確性や信頼性には配慮していますが、必ずしもそれらを保証はしません。意見や見解は、個人の立場において述べたものであり、所属組織等を代表するものではありません。コンテンツの利用およびその結果に対し、一切の責任を負いかねます</li><li>当サイトは amazon.co.jp を宣伝しリンクすることによって、サイトが紹介料を獲得できる手段を提供することを目的に設定されたアフィリエイト宣伝プログラムである、Amazon アソシエイト・プログラムの参加者です</li></ul></footer></div><script defer src=https://platform.twitter.com/widgets.js></script><script defer src=https://platform.instagram.com/en_US/embeds.js></script><script defer src=https://strava-embeds.com/embed.js></script><script defer src=https://embed.bsky.app/static/embed.js></script><script type=module src=https://unpkg.com/baseline-status@1.0.11/baseline-status.min.js></script><script type=module>
import hljs from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/highlight.min.js';

document.querySelectorAll('pre code').forEach(block => {
  hljs.highlightBlock(block);
});
</script><script type=module>
import AffiliateLink from '/js/affiliate-link.js';

customElements.define('affiliate-link', AffiliateLink);

const autoPhrase = document.querySelector('#auto-phrase');
const darkMode =  document.querySelector('#dark-mode');
autoPhrase.checked = localStorage.getItem('auto-phrase');
darkMode.checked = localStorage.getItem('dark-mode');

autoPhrase?.addEventListener('change', event => {
  if (event.target.checked) {
    localStorage.setItem('auto-phrase', true);
  } else {
    localStorage.removeItem('auto-phrase');
  }
});

darkMode?.addEventListener('change', event => {
  if (event.target.checked) {
    localStorage.setItem('dark-mode', true);
  } else {
    localStorage.removeItem('dark-mode');
  }
});

const shareButton = document.querySelector('.share button');
shareButton?.addEventListener('click', async event => {
  event.preventDefault();

  const data = {
    title: document.title,
    text: document.title,
    url: location.href
  };

  if (navigator.canShare?.(data)) {
    await navigator.share(data);
  } else {
    await navigator.clipboard?.writeText(`${data.title} ${data.url}`);
    const popover = document.querySelector('#Popover');
    popover.showPopover();

    setTimeout(() => {
      popover.hidePopover();
    }, 2000);
  }
});
</script></body></html>